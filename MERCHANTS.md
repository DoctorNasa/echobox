# EchoBox for Merchants (NYC) — Quick Start

> ใช้ EchoBox เพื่อออก “ของขวัญคริปโตแบบตั้งเวลาปลดล็อก (time-locked)” ให้ลูกค้า สำหรับโปรโมชัน พรีเพดเครดิต หรือของขวัญโอกาสพิเศษ  
> หมายเหตุ: ถ้าใช้งานเป็น “บัตรของขวัญ/เครดิตร้าน” โปรดปฏิบัติตามกฎหมายของรัฐนิวยอร์กและกฎหมายสหพันธรัฐ (ดูหัวข้อ Compliance)

---

## เหมาะกับใคร
- ร้านอาหาร / คาเฟ่ / ร้าน matcha
- ร้าน pet shop (อาบน้ำ–ตัดขน, อุปกรณ์สัตว์เลี้ยง)
- ผู้ประกอบการใน NYC ที่อยาก:
  - ขายพรีเพด/ของขวัญให้ลูกค้าล่วงหน้า
  - สร้างแคมเปญเทศกาล/วันเกิดด้วยการ “ปลดล็อก” ในวันที่กำหนด
  - ลด no-show ด้วยเครดิตที่ใช้ได้หลังถึงกำหนด

---

## ภาพรวมการทำงาน (Merchant & Customer Flow)

1) **ร้านค้าออก Gift**
- เชื่อมต่อกระเป๋า (Connect Wallet) ที่หน้า `/connect` หรือเพจเฉพาะ `/connect-gemini` (Gemini Wallet เท่านั้น) หรือ `/connect-privy` (Privy User SDK)  
- กรอก:
  - **ลูกค้า (ENS หรือ Address)** เช่น `alice.eth`
  - **วันที่ปลดล็อก** (เช่น วันเกิดลูกค้า)
  - **จำนวนเงิน**: ETH หรือโทเคน (เช่น PYUSD บน testnet)
- กด **Send Gift** → ทำธุรกรรม `createGift` (หรือ `createGiftToken`)

2) **ลูกค้ารับของขวัญ**
- เมื่อถึงเวลาปลดล็อก ลูกค้ากด **Claim** ได้ด้วยกระเป๋าของตน
- หากร้านต้องการให้ Gift ใช้เป็น “เครดิตร้าน/บัตรของขวัญ” ให้ตั้ง “**นโยบายการใช้**” (เช่น ใช้ได้เฉพาะสาขา/เมนู/ช่วงเวลา)

3) **การใช้งานหน้าร้าน**
- แสดง **QR** บนสลิป/อีเมล (เช่น `gift:` schema หรือ deeplink ไปยังหน้าแสดง Gift ID ทำให้แคชเชียร์ตรวจสถานะได้)
- แคชเชียร์เปิดหน้า “ตรวจสอบ Gift” → ใส่ **Gift ID + Contract** → ระบบโชว์สถานะ (ยังล็อก/ปลดล็อกแล้ว/เคลมแล้ว)

> เคล็ดลับ: ตั้งชื่อ ENS ของร้านเพื่อให้ง่ายต่อการแสดงผลย้อนกลับ (reverse) และลดความสับสนของ address

---

## ประเภทแคมเปญ (ตัวอย่าง)

| ประเภทร้าน | ชื่อแคมเปญ | แนวคิด |
|---|---|---|
| ร้าน matcha | **Birthday Matcha Vault** | ขายชุด matcha credit ที่ปลดล็อกวันเกิดลูกค้า |
| คาเฟ่ | **Morning Beans Unlock** | เครดิตกาแฟเช้า ปลดล็อกทุกวันจันทร์ของเดือนถัดไป |
| ร้านอาหาร | **Anniversary Dining Gift** | เครดิตดินเนอร์ปลดล็อกตรงวันครบรอบ |
| Pet shop | **Grooming Gift Lock** | เครดิตอาบน้ำ–ตัดขน ปลดล็อกหลังวันรับเลี้ยงสัตว์ |

---

## ฝั่งเทคนิค (สรุปสั้น)

- **ETH path:** ใช้ `createGift` พร้อม `msg.value`
- **ERC-20 path:** ใช้ `createGiftToken` หลังลูกค้าอนุมัติ `approve`
- **ENS:** ควรทำ **forward lookup** เวลาโอน และใช้ **reverse+forward verify** เวลาแสดงชื่อหน้าร้าน
- **PYUSD (ตัวอย่าง testnet):** ตั้งค่า address โทเคนใน `constants.ts` แล้วให้ลูกค้าเลือกในฟอร์ม

> โค้ดเพจ “Connect Wallet” มี 3 แบบ: `/connect` (wagmi ทั่วไป), `/connect-gemini`, `/connect-privy` — นำไปใช้ซ้ำในหน้า dApp ได้

---

## Merchant Playbook

### A. ขั้นตอนเริ่มใช้งาน (Setup)
- [ ] สร้าง/เชื่อมต่อกระเป๋าธุรกิจ (แนะนำแยกจากกระเป๋าส่วนตัว)
- [ ] ตั้งค่าหน้า “เงื่อนไขการใช้” ในเว็บ/หน้าร้าน
- [ ] เปิดเพจ Connect และทดสอบออก Gift จำนวนเล็กน้อย
- [ ] วาง **QR** บนใบเสร็จ/อีเมล/โปสเตอร์
- [ ] ฝึกพนักงานเรื่องการ “ตรวจ Gift” และการระวังสแกม (ดูป้ายเตือนด้านล่าง)

### B. ประสบการณ์หน้าร้าน (POS/แคชเชียร์)
1. ลูกค้าแสดง **QR Gift** หรือ **Gift ID**
2. แคชเชียร์เปิดหน้า “ตรวจ Gift” → ใส่ Gift ID
3. ระบบแสดงสถานะ:
   - ⏳ **Locked**: ยังใช้ไม่ได้ (ก่อนเวลา)
   - ✅ **Unlock & Unclaimed**: ใช้ได้
   - ✔️ **Claimed**: ถูกใช้ไปแล้ว
4. หากนโยบายเป็น **เครดิตร้าน** ให้บันทึกการใช้ตามระบบ POS ของร้าน (ออกใบกำกับ/ลดหนี้ ฯลฯ)

---

## Compliance (NY + Federal) — สรุปสำหรับ “เครดิตร้าน/บัตรของขวัญ”

> **สำคัญ:** ถ้าคุณใช้ EchoBox เป็น **“บัตรของขวัญ/เครดิตร้าน”** ในรัฐนิวยอร์ก ให้พิจารณากฎหลักต่อไปนี้ (ข้อมูลทั่วไป ไม่ใช่คำแนะนำทางกฎหมาย):

- **อายุบัตรอย่างน้อย 9 ปี (นิวยอร์ก):** ห้ามกำหนดวันหมดอายุก่อน **9 ปี** นับจากวันออก/เติมเงินล่าสุด (ยกเว้นบางกรณีของบัตรโปรโมชัน) ฯลฯ. อ้างอิง **GBS §396-i** และบทสรุปจากหน่วยงานรัฐนิวยอร์ก. :contentReference[oaicite:0]{index=0}
- **ห้ามคิดค่าธรรมเนียมที่ทำให้มูลค่าลดลง (นิวยอร์ก):** กฎหมายรัฐ NY ล่าสุดระบุว่าห้ามค่าธรรมเนียมลักษณะต่าง ๆ ที่ทำให้มูลค่าบัตรลดลง (เช่น dormancy, service, redemption ฯลฯ) โดยมีข้อยกเว้นจำกัด. :contentReference[oaicite:1]{index=1}
- **ขั้นต่ำ 5 ปี (กฎหมายสหพันธรัฐ/CARD Act):** ภายใต้กฎ **Regulation E §1005.20** ของ CFPB กำหนดให้เงินต้นไม่หมดอายุก่อน **5 ปี** และจำกัดค่าธรรมเนียมเฉื่อย/ไม่ใช้งาน (หากจะมี ต้องเปิดเผยอย่างเข้มงวด). กรณี NY ให้ยึดกฎที่ **เข้มกว่า** (9 ปี). :contentReference[oaicite:2]{index=2}
- **ป้ายเตือนสแกม (ร้านค้าต้องติดประกาศ):** ตั้งแต่ **20 มิ.ย. 2023** ร้านค้าที่จำหน่ายบัตรของขวัญต้อง **ติดป้ายเตือน Gift Card Scam** ใกล้จุดจำหน่าย/แสดงสินค้า (มี **ต้นฉบับ/ตัวอย่างป้าย** ให้ดาวน์โหลดจาก NY Dept. of State). :contentReference[oaicite:3]{index=3}
- **กำลังพิจารณา (NYC):** มีร่างกฎหมาย NYC เสนอให้ **บัตรกายภาพแบบหลายร้านค้า** ต้องมี **ชิป+PIN** (เพื่อป้องกันสแกม); ติดตามสถานะล่าสุดหากเกี่ยวข้องกับโมเดลของคุณ. :contentReference[oaicite:4]{index=4}

> เพิ่มเติม: ข้อกำหนดอื่น ๆ และการบังคับใช้ เปลี่ยนแปลงได้ ควรติดตาม DCWP/DoS และทนายความธุรกิจของคุณ. :contentReference[oaicite:5]{index=5}

---

## ป้ายเตือนสแกม (Template สำหรับร้าน)
> **คำเตือนการฉ้อโกงบัตรของขวัญ**  
> อย่าใช้บัตรของขวัญเพื่อชำระภาษี ค่าปรับ ประกัน หรือบิลสาธารณูปโภค หากมีคนขอให้คุณซื้อบัตรของขวัญแล้วอ่านรหัสให้ — นั่นคือ **สแกม**  
> ถ้าสงสัย โปรดสอบถามพนักงานหรือดูประกาศจากรัฐนิวยอร์ก  
> (อ้างอิง: แบบป้ายจาก NY Dept. of State — ติดใกล้จุดจำหน่าย) :contentReference[oaicite:6]{index=6}

---

## นโยบายการใช้ (ตัวอย่างที่แก้ไขได้)
- ใช้ได้เฉพาะสาขา: [ชื่อสาขา/ที่อยู่]
- ไม่สามารถแลกเป็นเงินสด (เว้นแต่ยอดคงเหลือ **ต่ำกว่า $5** ตามแนวทางรัฐนิวยอร์ก) :contentReference[oaicite:7]{index=7}
- ใช้ร่วมกับโปรโมชันอื่นได้/ไม่ได้: [เลือก]
- หากเป็น **เครดิตร้าน/บัตรของขวัญ**:  
  - ไม่มีค่าธรรมเนียมใดๆ  
  - วันหมดอายุไม่น้อยกว่า **9 ปี**  
  - ปฏิบัติตามกฎหมายที่เกี่ยวข้อง

> ใส่ลิงก์ไปยังหน้า “ตรวจ Gift” เพื่อให้ลูกค้าดูสถานะได้ด้วยตนเอง

---

## FAQ (สั้น)
**Q: ใช้เป็น “บัตรของขวัญดิจิทัล” ได้ไหม?**  
ได้ แต่ถ้าใช้งานเป็นเครดิตร้าน/บัตรของขวัญ ให้ทำตามข้อกำหนดเรื่องอายุ 9 ปี/ไม่มีค่าธรรมเนียม/ป้ายเตือนสแกม ตามกฎหมาย NY และ CARD Act (ดูหัวข้อ Compliance). :contentReference[oaicite:8]{index=8}

**Q: ลูกค้าไม่มี ENS?**  
สามารถใส่ address ตรงๆ ได้ แต่เพื่อความเป็นมิตร ควรสนับสนุน ENS และทำ reverse+forward verify เวลาแสดงผลชื่อ

**Q: จะตั้งให้ปลดล็อกตรงวันเกิดลูกค้าทุกปีได้ไหม?**  
ได้ (สร้าง gift ใหม่ตามรอบปี) และตั้ง countdown ในหน้า “ของขวัญของฉัน”

---

## เช็กลิสต์เปิดใช้งานเร็ว (Copy & Go)
- [ ] สร้างกระเป๋าร้าน (Business Wallet)
- [ ] ตั้ง `NEXT_PUBLIC_GIFTBOX_CONTRACT_ADDRESS` และโทเคนที่รองรับ
- [ ] เปิดเพจ Connect (`/connect`, `/connect-gemini`, `/connect-privy`)
- [ ] เขียนหน้า “ตรวจ Gift” (ค้นหาด้วย Gift ID + Contract)
- [ ] ออก Gift ทดลอง 1 รายการให้พนักงานทดสอบ Claim
- [ ] ติดป้ายเตือนสแกมที่จุดขาย ตามกฎหมาย NY (มีตัวอย่างป้าย) :contentReference[oaicite:9]{index=9}
- [ ] ปรับนโยบายการใช้ให้สอดคล้องกฎหมาย NY (9 ปี/ไม่มีค่าธรรมเนียม/เงินทอน <$5) :contentReference[oaicite:10]{index=10}

---

### หมายเหตุทางกฎหมาย
ข้อมูลนี้เป็น **ข้อมูลทั่วไป** ไม่ใช่คำแนะนำทางกฎหมาย โปรดปรึกษาทนายความก่อนใช้งานในเชิงพาณิชย์ โดยเฉพาะหากคุณจะออก **เครดิตร้าน/บัตรของขวัญ** ที่อยู่ภายใต้กฎหมายของรัฐนิวยอร์กและกฎหมายสหพันธรัฐสหรัฐฯ

